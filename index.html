<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta charset="utf-8">
  <title>Crisis Management Checklist</title>

  <!-- Google Analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-44982831-5', 'auto');
    ga('send', 'pageview');
  </script>
  <!-- End Google Analytics -->

  <link rel="shortcut icon" href="devchecklists/assets/favicon.png" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/8.3.1/markdown-it.min.js"></script>
  <script src="devchecklists/assets/markdown-it-task-lists.min.js"></script>

  <link rel="stylesheet"
    href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
    crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="devchecklists/assets/style.css">
</head>
  <body>
    <main role="main">
      <div class="container">
        <section class="checklist col-xs-12">
          <div class="row">
            <div class="checklist-content col-md-offset-1 col-md-10">
              <article class="markdown-body entry-content description" itemprop="text">
                <div>Loading...</div>
              </article>
            </div>
          </div>
        </section>
      </div>
    </main>
    <footer>
      <div class="container">
        <div class="col-xs-12">
          <p>Â© 2017 - Maintained by <a href="https://www.vinta.com.br" target="_blank">Vinta Sofware</a> - Feel free to <a href="https:&#x2F;&#x2F;github.com&#x2F;vintasoftware&#x2F;crisis-management-checklist" target="_blank">contribute</a></p>
        </div>
      </div>
    </footer>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"
      integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
      crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
      integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
      crossorigin="anonymous"></script>

    <script type="text/javascript">
      $(function() {
        function bindCheckBehavior(lang) {
          var langSuffix = lang === 'en' ? '' : lang;
          var checkedsDictKey = 'checkedsDict' + langSuffix;
          var checkedsDict = localStorage.getItem(checkedsDictKey);
          if (!checkedsDict || checkedsDict === '') {
            checkedsDict = {};
            localStorage.setItem(checkedsDictKey, JSON.stringify(checkedsDict));
          } else {
            checkedsDict = JSON.parse(checkedsDict);
          }

          var $items = $('.entry-content input.task-list-item-checkbox');
          $items.each(function (i, item) {
            var itemKey = $(item).parent().text();
            if (checkedsDict[itemKey]) {
              $(item).attr('checked', 'checked');
            }
          });

          $('.entry-content input').on('change', function() {
            var $items = $('.entry-content input');
            var updatedCheckedsDict = {};
            $items.each(function (i, item) {
              var itemKey = $(item).parent().text();
              if (this.checked) {
                updatedCheckedsDict[itemKey] = true;
              }
            });

            localStorage.setItem(checkedsDictKey, JSON.stringify(updatedCheckedsDict));
          });
        }

        var md = window.markdownit({
          'breaks': true,
          'linkify': false
        }).use(window.markdownitTaskLists, {enabled: true});

        function renderChecklist(lang) {
          $.ajax('/lang/' + lang + '/checklist.md', {
            method: 'GET',
            dataType: 'text'
          }).done(function(text) {
            $("a[data-lang='" + lang + "']").addClass('active');
            $("article.entry-content").html(md.render(text));
            bindCheckBehavior(lang);
            $("li ul.task-list").parent().addClass("special-bg");
            var $title = $(".markdown-body h1").html().replace("{nl}", "<br />");
            $(".markdown-body h1").html($title);
          }).fail(function() {
            console.error("Failed to GET checklist.md, is it a valid language?");
            setTimeout(renderChecklist, 1000);
          })
        }

        function defineChecklist() {
          $('a[data-lang]').click(function() {
            $('a[data-lang]').removeClass('active');
            renderChecklist($(this).data('lang'));
          });
        }

        defineChecklist();

        // Default: English
        renderChecklist('en');
      });
    </script>
  </body>
</html>

